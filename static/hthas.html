<html>
<head>
<title>HTHAS</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!--
How To Hear A Sentence

Copyright:
Yoni Ben-Meshulam
Marisa Plumb

Dojo GFX documentation:
http://api.dojotoolkit.org/jsdoc/1.3/dojox.gfx

Project site:
http://www.marisaplumb.com/ongoing
-->
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/dojo/1.3.1/dojo/dojo.xd.js" djConfig="isDebug: true"></script>
<!-- Load static sentences -->
<script type="text/javascript" src="http://omnib.in/hthas/sentences.js"></script>

<script type="text/javascript">
dojo.require("dojox.gfx");
dojo.require("dojox.gfx.fx");
dojo.require("dojo.colors");

var surfaceWidth = window.innerWidth - 20;
var surfaceHeight = window.innerHeight - 20;

/**
 * Set up our canvas with two axes and a green background.
 */
var surface, backgroundBox, verticalAxis, horizontalAxis, poemBox;
var makeShapes = function(){
	//create the surface
	surface = dojox.gfx.createSurface("test", surfaceWidth, surfaceHeight);
	//set a green background
	backgroundBox = surface.createRect({x: 0, y:0, width: surfaceWidth, height: surfaceHeight}).
		setFill("green");
	//set up the x/y axes
	verticalAxis = surface.createLine({x1:0, y1:0, x2:0, y2:surfaceHeight}).setStroke({color: "black",
			width: 8,
			join: "round"});
	horizontalAxis = surface.createLine({x1:0, y1:surfaceHeight, x2:surfaceWidth, y2:surfaceHeight}).setStroke({color: "black",
			width: 8,
			join: "round"});
	
	//set up an area for the poem
	poemBox = surface.createRect({x: 0, y:surfaceHeight-surfaceHeight/4, 
		   width: surfaceWidth/4, height: surfaceHeight/4}).
		setFill("#6666ff");

};
/**
 * Animate axes.
 */
var animateStroke = function(){
	var animH = dojox.gfx.fx.animateStroke({
		duration:	5000,
		shape: 		horizontalAxis,
		color:		{start: "gray", end: "orange"},
		width:		{start: 10, end: 30},
		join:		{values: ["bevel", "round"]}
	});
	var animV = dojox.gfx.fx.animateStroke({
		duration:	5000,
		shape: 		verticalAxis,
		color:		{start: "gray", end: "orange"},
		width:		{start: 10, end: 30},
		join:		{values: ["bevel", "round"]}
	});
	animH.play();
	animV.play();
};
/**
 * Animate background.
 */
var animateFill = function(){
	var anim = dojox.gfx.fx.animateFill({
		duration:	5000,
		shape: 		backgroundBox,
		color:		{start: "yellow", end: "blue"}
	});
	anim.play();
};


/**
 * The prototype for a sentence object. Takes optional arguments.
 * For example:
 * var mySentence = new sentenceProto({
 * 		text:"Some text i wrote",
 * 		id:0
 * });
 * 
 * To load the sentence onto the page, you would then call:
 * mySentence.loadSentence();
 * 
 * To animate, use:
 * mySentence.animateTransform();
 * 
 */
var createSentence = function(args){
	this.id = args.id==null ? undefined : args.id;
	this.text = args.text==null ? "Default text" : args.text;
	//position info
	this.posStart = {
		//default to center of the screen
		x: args.posStart==null? window.innerWidth*0.5 : args.posStart.x,
		y: args.posStart==null? window.innerHeight*0.5 : args.posStart.y
	}
	this.posMid = {
		x: args.posMid==null? 300 : args.posMid.x,
		y: args.posMid==null? 650 : args.posMid.y
	}
	this.posEnd = {
		x: args.posEnd==null? 300 : args.posEnd.x,
		y: args.posEnd==null? 400 : args.posEnd.y
	}
	
	//graphics functions
	this.loadSentence = function(){
		this.surfaceElement = surface.createText({x: this.posStart.x, y: this.posStart.y, text: this.text, align: "right"})
	 		.setFill("black").setFont({family: "serif", size: "10pt"});
	}
	
	this.animateTransform = function(){
		if(this.surfaceElement ==null ) {
			//sentence hasn't been loaded, see loadSentence()
			return;
		}
		var anim = dojox.gfx.fx.animateTransform({
				duration:	5000,
				shape: 		this.surfaceElement,
				transform:	[
					{name: "translate", start: [0, 0], end: [-200, -200]}
				]
		});
		anim.play();
	};
	
	this.animateFont = function(){
		var endFunc = this.animateTransform;
		var anim = dojox.gfx.fx.animateFont({
		    shape: this.surfaceElement,
		    duration: 5000,
		    variant: {values: ["normal", "small-caps"]},
		    size:  {start:10, end: 30, unit: "pt"}
		});
		anim.play();
	};
}                  
//an array to hold our sentences (which are also canvas elements)
animatedSentences = [];
var i = 0;
var addSentence = function(){
	if (i < sentences.length) {
		point = randomPoint();
		animatedSentences[i] = new createSentence({
			text: sentences[i].text,
			id: i,
			posStart: {
				x: point.x,
				y: point.y
			}
		});
		animatedSentences[i].loadSentence();
		animatedSentences[i].animateFont();
		animatedSentences[i].animateTransform();
		i++;
	} else {
		animateFill();
	}
}

var poemSentence;
function addPoem(){
	poemSentence = surface.createText({
		x: 100,
		y: 100,
		text: "A poem lies here. In fact, it's a ver very very long poem that has lots and lots of text. I'm not sure why it's so long, but it better be good. If it's no good, we'll just have to make a better, longer one.",
		align: "right"
	}).setFill("black").setFont({
		family: "serif",
		size: "10pt",
		width: "100px"
	});
}
/**
 * Helper function for getting a random point on the surface.
 */
function randomPoint() {
	return {x:Math.floor(Math.random()*surfaceWidth),
			y:Math.floor(Math.random()*surfaceHeight)};
}

/**
 * Called when the user presses any key.
 * @param {Object} event
 */
function controller(event) {
	key = event.charCode;
	var spacebar = 32;
	switch(key){
		case spacebar:
			addSentence();
			break;
		default:
			break;
	}
}

dojo.addOnLoad(makeShapes);
dojo.addOnLoad(addPoem);
dojo.connect(window, 'onkeypress', null, controller);
</script>

</head>
<body>
<div id="test" style="width: window.innerWidth; height: window.innerHeight;"></div>
</body>
</html>
